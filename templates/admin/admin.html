<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin • Dashboard</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="color-scheme" content="dark" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Caudex:wght@600;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    /* --- Base Styles & Variables --- */
:root{
    --bg:#0f141a; --card:#111821; --alt:#0c1218; --border:#2a3a49;
    --text:#e7edf4; --muted:#9cb0c3; --bright:#ffffff;
    --primary:#3d7ea6; --primary-hover:#336f93; --ring:rgba(61,126,166,.35);
    --danger:#d44a3a; --success:#46a490; --shadow:0 10px 40px rgba(0,0,0,.5);

    --parchment-dark: var(--bg);
    --parchment-light: var(--card);
    --ink-text: var(--text);
    --ink-muted: var(--muted);
    --ink-bright: var(--bright);
    --brush-stroke-border: var(--border);

    --water-tribe-blue: var(--primary);
    --harmony-gold:#b7d2e6;
    --generic-gold:#9cc4db;
    --fire-nation-red: var(--danger);
    --earth-kingdom-green:#6aa05d;
    --air-nomad-grey:#a0a09e;

    --focus-gold:#a7c7df;
    --button-gold: var(--primary);
    --button-gold-hover: var(--primary-hover);
  }

    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:16px/1.55 'Inter',system-ui,sans-serif;padding:24px}
    .container{max-width:1200px;margin:0 auto;display:grid;gap:18px}

    /* --- Typography & Links --- */
    h1{margin:0;display:flex;align-items:center;gap:.6rem;font:700 1.8rem 'Caudex',serif;color:var(--bright)}
    a{color:var(--primary);text-decoration:none;font-weight:700}
    a:hover{text-decoration:underline}
    .muted{color:var(--muted)}
    code{word-break:break-all}

    /* --- Layout & Cards --- */
    .header{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--border);padding-bottom:12px;position:relative}
    .vault-seal{width:34px;height:34px;color:var(--primary);flex-shrink:0}
    .flash{padding:12px 14px;border-radius:10px;border:1px solid var(--primary);
      background:rgba(195,154,63,.12);color:var(--primary);font-weight:700;margin-top:12px}
    .flash.error{border-color:var(--danger);background:rgba(240,71,71,.12);color:#fff}
    .flash.success{border-color:var(--success);background:rgba(67,181,129,.12);color:#0e1a0f}
    .grid{display:grid;gap:18px}
    .cards-3{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px}
    .row{display:grid;grid-template-columns:repeat(auto-fit,minmax(420px,1fr));gap:18px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:18px;box-shadow:var(--shadow);border-top:3px solid var(--primary)}
    .card h2{margin:0 0 .6rem;font:700 1.2rem 'Caudex',serif;color:var(--bright)}

    /* --- Stats, Forms & Tables --- */
    .stat{display:flex;align-items:center;justify-content:space-between;background:var(--alt);border:1px solid var(--border);border-radius:12px;padding:16px}
    .stat .label{font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.05em;font-size:.8rem}
    .stat .value{font-weight:800;color:var(--bright);font-size:1.35rem}
    label{display:block;margin-bottom:6px}
    button{padding:10px 14px;border:0;border-radius:10px;background:var(--primary);color:#0a0b0d;
      font-weight:800;cursor:pointer;font-family:'Caudex',serif}
    button:hover{background:var(--primary-hover)}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px 12px;border-bottom:1px solid var(--border);text-align:left;vertical-align:top}
    th{color:var(--muted);font:700 .8rem 'Caudex',serif;letter-spacing:.03em;text-transform:uppercase}
    .actions a{display:inline-block;padding:10px 12px;border:1px solid var(--border);border-radius:10px;background:var(--alt);text-decoration:none}
    .actions{display:flex;gap:10px;flex-wrap:wrap}

    tbody tr:nth-of-type(odd){background-color:var(--alt)}
    tbody tr{transition:background-color .15s ease}
    tbody tr:hover{background-color:rgba(195,154,63,.1)}

    .card, .actions a, button {transition:all .2s ease-out}
    .card:hover{transform:translateY(-4px);box-shadow:0 15px 45px rgba(0,0,0,.6)}
    .actions a:hover{border-color:var(--primary);box-shadow:0 0 0 3px var(--ring);transform:translateY(-2px)}

    .icon-link{display:inline-flex;align-items:center;gap:8px}
    .icon-link svg{width:1em;height:1em;flex-shrink:0}

    .inline{display:flex;gap:10px;align-items:flex-end;flex-wrap:wrap;margin-top:6px}
    input[type=number]{padding:10px;border-radius:10px;border:1px solid var(--border);background:#0f1114;color:var(--bright);min-width:120px}
    input:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 4px var(--ring)}

    /* ### Mobile Navigation ### */
    .nav{display:flex;gap:12px;flex-wrap:wrap}
    .menu-toggle{display:none}

    @media (max-width: 992px){
      .nav-links{
        display:none;
        position:absolute;
        top:85px; right:24px;
        background:var(--card);
        border:1px solid var(--border);
        border-radius:12px;
        box-shadow:var(--shadow);
        padding:12px;
        flex-direction:column;
        gap:0;
        z-index:1000;
        width:max-content;
        max-width:min(90vw, 360px);
      }
      .nav-links a{padding:12px 16px;border-radius:8px}
      .nav-links a:hover{background:var(--alt);text-decoration:none}
      .menu-toggle{
        display:block;background:none;border:none;padding:8px;cursor:pointer;color:var(--muted)
      }
      .menu-toggle:hover{color:var(--bright)}
      .menu-toggle svg{width:28px;height:28px}
      .nav-links.is-open{display:flex}
    }
    @media (max-width:480px){
      .header{flex-direction:column;align-items:flex-start;gap:16px}
      .nav{margin-left:auto}
      .nav-links{top:125px}
    }
  </style>
</head>
<body>
  <div class="container">

    <div class="header">
      <h1>
        <svg class="vault-seal" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
          <circle cx="50" cy="50" r="48" stroke="currentColor" stroke-width="3" fill="none"/>
          <path d="M50 2C30 2 12 18 12 50H50V2Z" fill="#d04033"/><path d="M50 98C70 98 88 82 88 50H50V98Z" fill="#5d8e9c"/><path d="M2 50C2 70 18 88 50 88V50H2Z" fill="#688a4c"/><path d="M98 50C98 30 82 12 50 12V50H98Z" fill="#a0a09e"/><circle cx="50" cy="50" r="22" fill="var(--card)"/><path d="M50 35c-4.4 0-8 3.6-8 8v14c0 4.4 3.6 8 8 8s8-3.6 8-8V43c0-4.4-3.6-8-8-8Z" fill="currentColor"/>
        </svg>
        Admin Dashboard
      </h1>
      <nav class="nav" aria-label="Admin navigation">
        <div class="nav-links" id="nav-links">
          <a href="{{ url_for('dashboard') }}" class="icon-link">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V15M8.25 21h7.5" /></svg>
            <span>Public Dashboard</span>
          </a>
          <a href="{{ url_for('admin.ops') }}" class="icon-link">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 11-3 0m3 0a1.5 1.5 0 10-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-9.75 0h9.75" /></svg>
            <span>Operations</span>
          </a>
          <a href="{{ url_for('admin.titles_page') }}" class="icon-link">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125" /></svg>
            <span>Titles</span>
          </a>
          <a href="{{ url_for('admin.reservations_page') }}" class="icon-link">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0h18M12 12.75h.008v.008H12v-.008z" /></svg>
            <span>Reservations</span>
          </a>
          <a href="{{ url_for('admin.servers_page') }}" class="icon-link">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21.75 17.25v-.228a4.5 4.5 0 00-.12-1.03l-2.268-9.64a3.375 3.375 0 00-3.285-2.602H7.926a3.375 3.375 0 00-3.285 2.602l-2.268 9.64a4.5 4.5 0 00-.12 1.03v.228m19.5 0a3 3 0 01-3 3H5.25a3 3 0 01-3-3m19.5 0a3 3 0 00-3-3H5.25a3 3 0 00-3 3m16.5 0h.008v.008h-.008v-.008z" /></svg>
            <span>Servers</span>
          </a>
          <a href="{{ url_for('admin.logout') }}" class="icon-link">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15M12 9l-3 3m0 0l3 3m-3-3h12.75" /></svg>
            <span>Logout</span>
          </a>
        </div>
        <button class="menu-toggle" id="menu-toggle" aria-label="Open navigation menu" aria-expanded="false" aria-controls="nav-links">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" /></svg>
        </button>
      </nav>
    </div>

    <p class="muted">Welcome, Guardian. This is the central control panel for managing titles, reservations, and Discord server settings.</p>

    {% for category, message in get_flashed_messages(with_categories=True) %}
      <div class="flash {{ category|e }}" role="alert" aria-live="polite">{{ message }}</div>
    {% endfor %}

    <div class="grid">
      <div class="cards-3" role="region" aria-label="System Stats">
        <div class="stat"><div class="label">Configured Titles</div><div class="value">{{ (stats.title_count if stats is defined else 0) | default(0, true) }}</div></div>
        <div class="stat"><div class="label">Total Reservations</div><div class="value">{{ (stats.reservation_count if stats is defined else 0) | default(0, true) }}</div></div>
        <div class="stat"><div class="label">Connected Servers</div><div class="value">{{ (stats.server_count if stats is defined else 0) | default(0, true) }}</div></div>
      </div>
      <div class="row">
        <section class="card" aria-labelledby="shift-heading">
          <h2 id="shift-heading">Shift Hours</h2>
          <p class="muted">
            This sets the standard duration for all reservable titles. A 12-hour shift means a reservation at 00:00 UTC will expire at 12:00 UTC.<br>
            Current value: <strong>{{ shift | default(12, true) }}</strong> hour(s).
          </p>
          <form class="inline" action="{{ url_for('admin.set_shift') }}" method="POST" autocomplete="off">
            <div>
              <label for="hours" class="muted">Set New Duration (hours)</label>
              <input id="hours" name="hours" type="number" min="1" max="72" step="1" placeholder="e.g. 12" value="{{ shift | default(12, true) }}" required inputmode="numeric" />
            </div>
            <button type="submit">Update</button>
          </form>
          <div class="actions" style="margin-top:14px">
            <a href="{{ url_for('admin.ops') }}">Open Operations</a>
            <a href="{{ url_for('admin.titles_page') }}">Manage Titles</a>
            <a href="{{ url_for('admin.reservations_page') }}">View Reservations</a>
            <a href="{{ url_for('admin.servers_page') }}">Server Settings</a>
          </div>
        </section>
        <section class="card" aria-labelledby="servers-heading">
          <h2 id="servers-heading">Connected Servers</h2>
          {% if servers %}
            <p class="muted">A list of Discord servers using this tool. One must be the 'Default' for bot commands to function.</p>
            <table aria-describedby="servers-heading">
              <thead>
                <tr>
                  <th scope="col">Server (Guild ID)</th>
                  <th scope="col">Default Server</th>
                  <th scope="col">Guardian Role ID</th>
                </tr>
              </thead>
              <tbody>
                {% for s in servers %}
                  <tr>
                    <td><code>{{ s.guild_id }}</code></td>
                    <td>{% if s.is_default %}✅ Yes{% else %}<span class="muted">No</span>{% endif %}</td>
                    <td><code>{{ s.guardian_role_id or '-' }}</code></td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
            <div class="actions" style="margin-top:12px">
              <a href="{{ url_for('admin.servers_page') }}" class="icon-link">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21.75 17.25v-.228a4.5 4.5 0 00-.12-1.03l-2.268-9.64a3.375 3.375 0 00-3.285-2.602H7.926a3.375 3.375 0 00-3.285 2.602l-2.268 9.64a4.5 4.5 0 00-.12 1.03v.228m19.5 0a3 3 0 01-3 3H5.25a3 3 0 01-3-3m19.5 0a3 3 0 00-3-3H5.25a3 3 0 00-3 3m16.5 0h.008v.008h-.008v-.008z" /></svg>
                <span>Manage Servers</span>
              </a>
            </div>
          {% else %}
            <p class="muted">No Discord servers are connected. The bot will not function until at least one server is added and set as the default.</p>
            <div class="actions">
              <a href="{{ url_for('admin.servers_page') }}" class="icon-link">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v6m3-3H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                <span>Add a Server</span>
              </a>
            </div>
          {% endif %}
        </section>
      </div>

      <section class="card" aria-labelledby="titles-heading">
        <h2 id="titles-heading">System Titles</h2>
        {% if titles %}
          <p class="muted">'Requestable' titles appear on the public reservation dashboard for players to choose.</p>
          <table aria-describedby="titles-heading">
            <thead>
              <tr>
                <th scope="col">Name</th>
                <th scope="col">Requestable?</th>
                <th scope="col">Icon Path</th>
              </tr>
            </thead>
            <tbody>
              {% for t in titles %}
                <tr>
                  <td><strong>{{ t.name }}</strong></td>
                  <td>{{ '✅ Yes' if t.requestable else '❌ No' }}</td>
                  <td><code>{{ t.icon_url or '-' }}</code></td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
          <div class="actions" style="margin-top:12px">
            <a href="{{ url_for('admin.titles_page') }}" class="icon-link">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125" /></svg>
              <span>Manage Titles</span>
            </a>
          </div>
        {% else %}
          <p class="muted">No titles have been created yet. You must add titles before players can make reservations.</p>
          <div class="actions">
            <a href="{{ url_for('admin.titles_page') }}" class="icon-link">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v6m3-3H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
              <span>Add Titles</span>
            </a>
          </div>
        {% endif %}
      </section>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function(){
      const menuToggle = document.getElementById('menu-toggle');
      const navLinks = document.getElementById('nav-links');
      if(menuToggle && navLinks){
        menuToggle.addEventListener('click', function(){
          const isExpanded = menuToggle.getAttribute('aria-expanded') === 'true';
          navLinks.classList.toggle('is-open');
          menuToggle.setAttribute('aria-expanded', String(!isExpanded));
        });
        document.addEventListener('click', function(ev){
          const inside = navLinks.contains(ev.target) || menuToggle.contains(ev.target);
          if(!inside && navLinks.classList.contains('is-open')){
            navLinks.classList.remove('is-open');
            menuToggle.setAttribute('aria-expanded','false');
          }
        });
      }
    });
  </script>

</body>
</html>